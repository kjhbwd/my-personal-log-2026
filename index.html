<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>River ê¸€ë¡œë²Œ ìƒí˜¸ êµë¥˜ í™œì„±í™”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        .box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 15px; }
        input { background: #0f172a !important; border: 1px solid #475569; border-radius: 8px; padding: 10px; color: white; outline: none; font-size: 14px; }
        .brand-gradient { background: linear-gradient(135deg, #60a5fa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .nav-header { display: flex; justify-content: space-between; align-items: start; width: 100%; gap: 10px; }
        .title-area { flex: 1; text-align: center; padding-top: 5px; }
        .main-title-text { white-space: nowrap; font-weight: 900; display: inline-block; font-style: normal !important; letter-spacing: -0.02em; }
        
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(192, 132, 252, 0.7); transform: scale(1); }
            70% { box-shadow: 0 0 0 10px rgba(192, 132, 252, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(192, 132, 252, 0); transform: scale(1); }
        }
        .dev-btn-group { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .btn-dev-flashy { background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; color: white; padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 900; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(59,130,246,0.4); }
        .btn-river-flashy { background: linear-gradient(135deg, #c084fc, #db2777); border: none; color: white; padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 900; cursor: pointer; animation: pulse-glow 2s infinite; }

        .clock-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; background: rgba(30, 41, 59, 0.5); padding: 8px; border-radius: 12px; border: 1px solid #334155; }
        .clock-item { display: flex; flex-direction: column; align-items: center; min-width: 50px; }
        .clock-label { font-size: 9px; font-weight: 900; color: #6366f1; }
        .clock-time { font-size: 12px; font-weight: 700; color: #60a5fa; font-family: 'monospace'; }

        .asset-widget { background: rgba(30, 41, 59, 0.95); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 14px; padding: 8px 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        .tab-active { background: #4f46e5 !important; color: white !important; font-weight: 900; }
        
        .daily-log-box { background: rgba(15, 23, 42, 0.7); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 10px; margin-top: 8px; width: 100%; max-width: 320px; }
        .log-row { display: flex; justify-content: space-between; align-items: center; font-size: 11px; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
        
        .btn-icon { cursor: pointer; transition: opacity 0.2s; font-size: 14px; padding: 4px; }
        .member-link { color: #60a5fa; cursor: pointer; text-decoration: underline; text-underline-offset: 4px; font-weight: 700; }
        .page-btn { background: #334155; color: #94a3b8; padding: 4px 10px; border-radius: 6px; font-size: 12px; }
        .page-btn.active { background: #6366f1; color: white; font-weight: 900; }

        #adminStatsPanel { display: none; margin-top: 20px; background: linear-gradient(to right, #1e293b, #0f172a); border: 1px solid #6366f1; border-radius: 12px; padding: 15px; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-slate-900/95 backdrop-blur-md border-b border-slate-800 p-4">
        <div class="max-w-7xl mx-auto nav-header">
            <div id="clockDisplay" class="clock-grid"></div>
            <div class="title-area">
                <span id="main-title" class="main-title-text brand-gradient text-xl md:text-3xl">River ê¸€ë¡œë²Œ ìƒí˜¸ êµë¥˜ í™œì„±í™”</span>
                <div class="dev-btn-group">
                    <button id="btnDevLink" onclick="trackAndGo('Developer', 'https://x.com/thejediworld77')" class="btn-dev-flashy">ê°œë°œì:ê¹€ì§€í˜¸bwd</button>
                    <button id="btnRiverLink" onclick="trackAndGo('RiverRef', 'https://app.river.inc/fun?ref=thejediworld77')" class="btn-river-flashy">Riverë€?</button>
                </div>
            </div>
            <div class="flex flex-col items-end">
                <div class="asset-widget flex items-center gap-3">
                    <div class="flex flex-col items-center">
                        <span id="lbl-mypts" class="text-[7px] text-slate-500 font-black">ë‚˜ì˜ PTS</span>
                        <input id="calcQty" type="number" oninput="runCalculation()" placeholder="0" class="w-14 text-center bg-transparent border-none text-white font-bold outline-none">
                    </div>
                    <div class="h-6 w-[1px] bg-slate-700"></div>
                    <div class="flex flex-col items-center">
                        <span id="lbl-ptsprice" class="text-[7px] text-indigo-400 font-black">PTS PRICE</span>
                        <span id="ptsPriceDisplay" class="text-[10px] font-black text-white">$ 0.000000</span>
                    </div>
                    <div class="h-6 w-[1px] bg-slate-700"></div>
                    <div class="flex flex-col items-end">
                        <span id="lbl-value" class="text-[7px] text-green-500 font-black">KRW VALUE</span>
                        <span id="resKrw" class="text-[12px] font-black text-white">â‚© 0</span>
                        <span id="currentUsdtRate" class="text-[8px] text-slate-500 font-mono">1 USDT = â‚© 0</span>
                    </div>
                </div>
                <div class="daily-log-box">
                    <div class="flex gap-2 mb-2">
                        <input id="dailyPtsInput" type="number" placeholder="ìˆ˜ëŸ‰" class="flex-1 bg-transparent border-b border-slate-600 text-[11px] p-1 text-white outline-none">
                        <button onclick="addDailyLogToDB()" id="btnLogAdd" class="bg-indigo-600 px-3 py-1 rounded text-[11px] font-black text-white">ê¸°ë¡</button>
                    </div>
                    <div id="dailyLogList" class="max-h-24 overflow-y-auto no-scrollbar"></div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto p-4 space-y-6">
        <div class="flex justify-end">
            <select id="langSelect" onchange="changeLanguage(this.value)" class="bg-slate-800 text-[11px] text-white rounded px-2 py-1 border border-slate-700 outline-none cursor-pointer">
                <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option><option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option><option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
            </select>
        </div>

        <div class="box border-2 border-indigo-500/20 shadow-xl space-y-4">
            <div class="flex gap-2">
                <input id="managerId" type="text" placeholder="ID ì…ë ¥" class="flex-1 border-indigo-500/40">
                <button onclick="saveAndConnect()" id="btnConnect" class="bg-indigo-600 px-6 rounded-lg font-black text-sm text-white">ì ‘ì†</button>
            </div>
            <div id="guideContent" class="guide-box"></div>
        </div>

        <div class="box bg-slate-800/30 flex gap-2">
            <input id="newMemberName" type="text" class="flex-1" placeholder="X ë‹‰ë„¤ì„">
            <input id="newMemberXId" type="text" class="flex-1" placeholder="X ì•„ì´ë”” (@ì•„ì´ë””)">
            <button onclick="addNewMember()" id="btnAddMember" class="bg-blue-600 px-6 rounded-lg font-black text-xs text-white">ì¶”ê°€</button>
        </div>

        <div class="flex justify-between gap-1 bg-slate-800/50 p-1 rounded-xl overflow-x-auto no-scrollbar">
            <button onclick="switchCountry('KR')" id="tab-KR" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">KR</button>
            <button onclick="switchCountry('US')" id="tab-US" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">US</button>
            <button onclick="switchCountry('CN')" id="tab-CN" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">CN</button>
            <button onclick="switchCountry('JP')" id="tab-JP" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">JP</button>
            <button onclick="switchCountry('VN')" id="tab-VN" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">VN</button>
            <button onclick="switchCountry('TR')" id="tab-TR" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">TR</button>
        </div>

        <div class="box p-0 overflow-hidden border-slate-800 shadow-2xl">
            <table class="w-full text-left">
                <tbody id="userTableBody" class="text-sm divide-y divide-slate-800"></tbody>
            </table>
        </div>
        <div id="pagination" class="flex justify-center gap-2 pt-2"></div>

        <div id="adminStatsPanel">
            <h3 class="text-indigo-400 font-black mb-2 text-sm">ğŸ† SECRET MASTER STATS (Unique IPs)</h3>
            <div id="statText" class="text-xs text-slate-300 font-mono">Loading...</div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xheuxdsbwcueutukeblm.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_TW6tF_10D5-zv5FdXZE87g_8sNPZmuF'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const PRIVATE_CODE = '2126', MASTER_ADMIN_CODE = '7777';
        
        let currentCountry = 'KR', currentLang = 'ko', allUsers = [], currentPage = 1;
        const itemsPerPage = 10, timeZones = { KR: 'Asia/Seoul', US: 'America/New_York', CN: 'Asia/Shanghai', JP: 'Asia/Tokyo', VN: 'Asia/Ho_Chi_Minh', TR: 'Europe/Istanbul' };
        let livePtsPrice = 0, usdtKrwRate = 1485;

        const translations = {
            ko: { title: "River ê¸€ë¡œë²Œ ìƒí˜¸ êµë¥˜ í™œì„±í™”", connect: "ì ‘ì†", logBtn: "ê¸°ë¡", mypts: "ë‚˜ì˜ PTS", ptsprice: "PTS PRICE", value: "KRW VALUE", xName: "X ë‹‰ë„¤ì„", xId: "X ì•„ì´ë”” (@ì•„ì´ë””)", addBtn: "ì¶”ê°€", devBtn: "ê°œë°œì:ê¹€ì§€í˜¸bwd", riverBtn: "Riverë€?", logPlace: "ìˆ˜ëŸ‰", guide: "<strong>ğŸ’¡ ì•ˆë‚´:</strong><br>1. ì›í•˜ëŠ” ì œëª©ì„ ì •í•˜ê³  **ì ‘ì†**ì„ ëˆŒëŸ¬ì£¼ì„¸ìš” (ë¹„ë°€ë²ˆí˜¸ í•„ìš”).<br>2. **ì´ë¦„ì„ í´ë¦­**í•˜ë©´ ì—°ê²°ëœ X ê³„ì •ìœ¼ë¡œ ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br>3. ğŸ”¼/ğŸ”½ í™”ì‚´í‘œë¡œ ëª…ë‹¨ ìˆœìœ„ë¥¼ **í•œ ì¹¸ì”©** ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
            en: { title: "River Global Exchange Activation", connect: "Connect", logBtn: "Add", mypts: "MY PTS", ptsprice: "PTS PRICE", value: "KRW VALUE", xName: "X Nickname", xId: "X ID (@username)", addBtn: "Add", devBtn: "Dev: Jiho Kim bwd", riverBtn: "What is River?", logPlace: "Qty", guide: "<strong>ğŸ’¡ Info:</strong><br>1. Choose a title and press **Connect** (Password required).<br>2. **Click the name** to visit their X profile immediately.<br>3. Use ğŸ”¼/ğŸ”½ to adjust the rank **one step at a time**." },
            zh: { title: "River å…¨çƒç›¸äº’äº¤æµæ¿€æ´»", connect: "è¿æ¥", logBtn: "è®°å½•", mypts: "æˆ‘çš„ PTS", ptsprice: "PTS ä»·æ ¼", value: "KRW ä»·å€¼", xName: "X æ˜µç§°", xId: "X ID (@è´¦å·)", addBtn: "æ·»åŠ ", devBtn: "å¼€å‘è€…: é‡‘æ™ºæµ©bwd", riverBtn: "ä»€ä¹ˆæ˜¯ River?", logPlace: "æ•°é‡", guide: "<strong>ğŸ’¡ æŒ‡å—:</strong><br>1. é€‰æ‹©ä¸€ä¸ªæ ‡é¢˜å¹¶ç‚¹å‡»**è¿æ¥** (éœ€è¦å¯†ç )ã€‚<br>2. **ç‚¹å‡»åå­—** ç«‹å³è®¿é—®å…¶ X ä¸ªäººèµ„æ–™ã€‚<br>3. ä½¿ç”¨ ğŸ”¼/ğŸ”½ **é€çº§** è°ƒæ•´æ’åã€‚" },
            tr: { title: "River KÃ¼resel DeÄŸiÅŸim Aktivasyonu", connect: "BaÄŸlan", logBtn: "Ekle", mypts: "PTS'LERÄ°M", ptsprice: "PTS FÄ°YATI", value: "KRW DEÄERÄ°", xName: "X Takma AdÄ±", xId: "X KimliÄŸi (@kullanÄ±cÄ±)", addBtn: "Ekle", devBtn: "GeliÅŸtirici: Jiho Kim bwd", riverBtn: "River nedir?", logPlace: "Adet", guide: "<strong>ğŸ’¡ Bilgi:</strong><br>1. Ä°stediÄŸiniz baÅŸlÄ±ÄŸÄ± girin ve **BaÄŸlan**'a basÄ±n (Åifre gereklidir).<br>2. X profilini ziyaret etmek iÃ§in **isme tÄ±klayÄ±n**.<br>3. SÄ±ralamayÄ± **tek tek** ayarlamak iÃ§in ğŸ”¼/ğŸ”½ kullanÄ±n." },
            ja: { title: "River ã‚°ãƒ­ãƒ¼ãƒãƒ«ç›¸äº’äº¤æµã®æ´»æ€§åŒ–", connect: "æ¥ç¶š", logBtn: "ç™»éŒ²", mypts: "ãƒã‚¤ PTS", ptsprice: "PTS ä¾¡æ ¼", value: "KRW ä¾¡å€¤", xName: "X ë‹‰ë„¤ì„", xId: "X ID (@ì•„ì´ë””)", addBtn: "è¿½åŠ ", devBtn: "é–‹ç™ºè€…: ã‚­ãƒ ãƒ»ã‚¸ãƒ›bwd", riverBtn: "Riverã¨ã¯ï¼Ÿ", logPlace: "æ•°é‡", guide: "<strong>ğŸ’¡ æ¡ˆå†…:</strong><br>1. ã‚¿ã‚¤í‹€ì„ ì •í•˜ê³  **ì ‘ì†**ì„ ëˆŒëŸ¬ì£¼ì„¸ìš” (ë¹„ë°€ë²ˆí˜¸ í•„ìš”).<br>2. **ì´ë¦„ì„ í´ë¦­**í•˜ë©´ X ê³„ì •ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br>3. ğŸ”¼/ğŸ”½ë¡œ ìˆœìœ„ë¥¼ **í•˜ë‚˜ì”©** ì¡°ì •í•˜ì„¸ìš”." },
            vi: { title: "KÃ­ch hoáº¡t trao Ä‘á»•i toÃ n cáº§u River", connect: "Káº¿t ná»‘i", logBtn: "Gá»­i", mypts: "PTS Cá»¦A TÃ”I", ptsprice: "GIÃ PTS", value: "GIÃ TRá»Š KRW", xName: "Biá»‡t danh X", xId: "ID X (@username)", addBtn: "ThÃªm", devBtn: "PhÃ¡t triá»ƒn: Jiho Kim bwd", riverBtn: "River lÃ  gÃ¬?", logPlace: "Sá»‘ lÆ°á»£ng", guide: "<strong>ğŸ’¡ HD:</strong><br>1. Chá»n tiÃªu Ä‘á» vÃ  nháº¥n **Káº¿t ná»‘i** (Cáº§n máº­t kháº©u).<br>2. **Nháº¥n tÃªn** Ä‘á»ƒ truy cáº­p X ngay láº­p tá»©c.<br>3. DÃ¹ng ğŸ”¼/ğŸ”½ Ä‘á»ƒ chá»‰nh thá»© háº¡ng **tá»«ng bÆ°á»›c**." }
        };

        // ğŸ›¡ï¸ IP ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€ íŠ¸ë˜í‚¹ ë¡œì§
        async function trackAndGo(type, url) {
            const mId = document.getElementById('managerId').value || 'anonymous';
            try {
                // 1. í˜„ì¬ ì‚¬ìš©ìì˜ IP ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                const userIp = ipData.ip;

                // 2. ì´ IPê°€ ì´ ë²„íŠ¼(type)ì„ ëˆ„ë¥¸ ì ì´ ìˆëŠ”ì§€ í™•ì¸
                const { data: existing } = await supabaseClient
                    .from('river_clicks')
                    .select('*')
                    .eq('ip_address', userIp)
                    .eq('btn_type', type)
                    .limit(1);

                // 3. ê¸°ë¡ì´ ì—†ë‹¤ë©´ ìƒˆë¡­ê²Œ ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
                if (!existing || existing.length === 0) {
                    await supabaseClient.from('river_clicks').insert([
                        { manager_id: mId, btn_type: type, ip_address: userIp }
                    ]);
                }
            } catch (e) { console.error("Tracking Error:", e); }
            window.open(url, '_blank');
        }

        async function showAdminStats() {
            // DBì— ì €ì¥ëœ ê³ ìœ  IP ë°ì´í„°ë§Œ ê°€ì ¸ì™€ì„œ ì¶œë ¥
            const { data } = await supabaseClient.from('river_clicks').select('*');
            if(data) {
                const dev = data.filter(c => c.btn_type === 'Developer').length;
                const ref = data.filter(c => c.btn_type === 'RiverRef').length;
                document.getElementById('statText').innerHTML = `Unique Dev: ${dev} | Unique RiverRef: ${ref} | Total Visitors: ${data.length}`;
            }
        }

        async function saveAndConnect() { 
            const mId = document.getElementById('managerId').value;
            const code = prompt("Password:");
            if (code === MASTER_ADMIN_CODE) {
                localStorage.setItem('river_manager_id', mId);
                document.getElementById('adminStatsPanel').style.display = 'block';
                showAdminStats(); fetchUsers(); fetchDailyLogs();
            } else if (code === PRIVATE_CODE) {
                localStorage.setItem('river_manager_id', mId);
                document.getElementById('adminStatsPanel').style.display = 'none';
                fetchUsers(); fetchDailyLogs();
            } else { alert("X"); }
        }

        async function updateMarketData() {
            try {
                const bRes = await fetch('https://api.bithumb.com/public/ticker/USDT_KRW');
                const bData = await bRes.json();
                if(bData.status === "0000") {
                    usdtKrwRate = parseFloat(bData.data.closing_price);
                    document.getElementById('currentUsdtRate').innerText = `1 USDT = â‚© ${usdtKrwRate.toLocaleString()}`;
                }
                const tokenAddr = "0xfc6be825925b7a83d131e33b46efef9084f0e014";
                const pRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${tokenAddr}`);
                const pData = await pRes.json();
                if(pData.pairs && pData.pairs.length > 0) {
                    livePtsPrice = parseFloat(pData.pairs[0].priceUsd);
                    document.getElementById('ptsPriceDisplay').innerText = `$ ${livePtsPrice.toFixed(6)}`;
                }
                runCalculation();
            } catch(e) {}
        }

        function runCalculation() {
            const qty = parseFloat(document.getElementById('calcQty').value) || 0;
            const total = qty * livePtsPrice * usdtKrwRate;
            document.getElementById('resKrw').innerText = `â‚© ${Math.floor(total).toLocaleString()}`;
        }

        async function addDailyLogToDB() {
            const mId = document.getElementById('managerId').value;
            const qty = document.getElementById('dailyPtsInput').value;
            if(!mId || !qty) return;
            await supabaseClient.from('river_daily_logs').insert([{ manager_id: mId, amount: parseInt(qty) }]);
            document.getElementById('dailyPtsInput').value = ''; fetchDailyLogs();
        }

        async function fetchDailyLogs() {
            const mId = document.getElementById('managerId').value;
            if(!mId) return;
            const { data } = await supabaseClient.from('river_daily_logs').select('*').eq('manager_id', mId).order('created_at', { ascending: false }).limit(10);
            document.getElementById('dailyLogList').innerHTML = (data || []).map(l => {
                const d = new Date(l.created_at);
                return `<div class="log-row"><div>ğŸ—“ï¸ ${d.getMonth()+1}/${d.getDate()} <span class="font-bold text-indigo-400 ml-2">${l.amount.toLocaleString()} Pts</span></div><div class="flex gap-3"><span onclick="editLog(${l.id}, ${l.amount})" class="btn-icon">âœï¸</span><span onclick="deleteLog(${l.id})" class="btn-icon">âŒ</span></div></div>`;
            }).join('');
        }

        async function editLog(id, old) {
            const val = prompt("Edit:", old);
            if(val) { await supabaseClient.from('river_daily_logs').update({ amount: parseInt(val) }).eq('id', id); fetchDailyLogs(); }
        }
        async function deleteLog(id) {
            if(confirm("Delete?")) { await supabaseClient.from('river_daily_logs').delete().eq('id', id); fetchDailyLogs(); }
        }

        async function addNewMember() {
            const mId = document.getElementById('managerId').value;
            const name = document.getElementById('newMemberName').value, xId = document.getElementById('newMemberXId').value;
            if(!mId || !name) return;
            const { data } = await supabaseClient.from('river_members').select('priority').eq('manager_id', mId).eq('country', currentCountry).order('priority', { ascending: false }).limit(1);
            const nextP = (data && data.length > 0) ? data[0].priority + 1 : 1;
            const cleanX = xId.startsWith('@') ? xId.substring(1) : xId;
            await supabaseClient.from('river_members').insert([{ manager_id: mId, name: name, x_id: cleanX, country: currentCountry, priority: nextP }]);
            document.getElementById('newMemberName').value = ''; document.getElementById('newMemberXId').value = ''; fetchUsers();
        }

        async function moveMember(globalIndex, direction) {
            const targetIndex = globalIndex + direction;
            if (targetIndex < 0 || targetIndex >= allUsers.length) return;
            const current = allUsers[globalIndex], target = allUsers[targetIndex];
            await supabaseClient.from('river_members').update({ priority: target.priority }).eq('id', current.id);
            await supabaseClient.from('river_members').update({ priority: current.priority }).eq('id', target.id);
            fetchUsers();
        }

        async function editMember(id, old) {
            const n = prompt("Edit:", old);
            if(n) { await supabaseClient.from('river_members').update({ name: n }).eq('id', id); fetchUsers(); }
        }
        async function deleteMember(id) {
            if(confirm("Delete?")) { await supabaseClient.from('river_members').delete().eq('id', id); fetchUsers(); }
        }

        async function fetchUsers() {
            const mId = document.getElementById('managerId').value;
            if(!mId) return;
            const { data } = await supabaseClient.from('river_members').select('*').eq('manager_id', mId).eq('country', currentCountry).order('priority', { ascending: false });
            allUsers = data || []; renderTable();
        }

        function renderTable() {
            const body = document.getElementById('userTableBody'); body.innerHTML = '';
            const start = (currentPage - 1) * itemsPerPage;
            const pData = allUsers.slice(start, start + itemsPerPage);
            pData.forEach((u, i) => {
                const gIdx = start + i;
                const link = u.x_id ? `<span class="member-link" onclick="window.open('https://x.com/${u.x_id}', '_blank')">${u.name}</span>` : `<span>${u.name}</span>`;
                body.innerHTML += `<tr><td class="p-4 flex justify-between items-center"><div><span class="text-indigo-400 font-black mr-2">#${gIdx+1}</span><strong>${link}</strong></div><div class="flex gap-4 text-xl"><span onclick="moveMember(${gIdx}, -1)" class="btn-icon text-blue-400">ğŸ”¼</span><span onclick="moveMember(${gIdx}, 1)" class="btn-icon text-blue-400">ğŸ”½</span><span onclick="editMember(${u.id}, '${u.name}')" class="btn-icon text-orange-400 text-sm">âœï¸</span><span onclick="deleteMember(${u.id})" class="btn-icon text-red-500 text-sm">âŒ</span></div></td></tr>`;
            });
            renderPagination();
        }

        function renderPagination() {
            const div = document.getElementById('pagination'); div.innerHTML = '';
            const totalP = Math.ceil(allUsers.length / itemsPerPage);
            if (totalP <= 1) return;
            for (let i = 1; i <= totalP; i++) {
                const btn = document.createElement('button');
                btn.innerText = i; btn.className = `page-btn ${currentPage === i ? 'active' : ''} mx-1`;
                btn.onclick = () => { currentPage = i; renderTable(); }; div.appendChild(btn);
            }
        }

        function changeLanguage(lang) {
            currentLang = lang; const t = translations[lang] || translations.ko;
            document.getElementById('main-title').innerText = t.title;
            document.getElementById('btnConnect').innerText = t.connect;
            document.getElementById('btnLogAdd').innerText = t.logBtn;
            document.getElementById('lbl-mypts').innerText = t.mypts;
            document.getElementById('lbl-ptsprice').innerText = t.ptsprice;
            document.getElementById('lbl-value').innerText = t.value;
            document.getElementById('guideContent').innerHTML = t.guide;
            document.getElementById('newMemberName').placeholder = t.xName;
            document.getElementById('newMemberXId').placeholder = t.xId;
            document.getElementById('btnAddMember').innerText = t.addBtn;
            document.getElementById('btnDevLink').innerText = t.devBtn;
            document.getElementById('btnRiverLink').innerText = t.riverBtn;
            document.getElementById('dailyPtsInput').placeholder = t.logPlace;
            fetchDailyLogs();
        }

        function switchCountry(code) { 
            currentCountry = code; currentPage = 1;
            document.querySelectorAll('[onclick^="switchCountry"]').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab-${code}`).classList.add('tab-active');
            fetchUsers(); 
        }

        window.onload = () => {
            updateMarketData(); setInterval(updateMarketData, 60000);
            const savedId = localStorage.getItem('river_manager_id');
            if(savedId) document.getElementById('managerId').value = savedId;
            changeLanguage('ko'); switchCountry('KR');
            setInterval(() => {
                const html = Object.keys(timeZones).map(code => {
                    const time = new Date().toLocaleTimeString('en-US', { timeZone: timeZones[code], hour: '2-digit', minute: '2-digit', hour12: false });
                    return `<div class="clock-item"><span class="clock-label">${code}</span><span class="clock-time">${time}</span></div>`;
                }).join('');
                document.getElementById('clockDisplay').innerHTML = html;
            }, 1000);
        };
    </script>
</body>
</html>
