<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIVER LOG - Master Global Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 15px; }
        input { background: #0f172a; border: 1px solid #475569; border-radius: 8px; padding: 12px; color: white; width: 100%; outline: none; font-size: 16px; }
        .brand-gradient { background: linear-gradient(135deg, #60a5fa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .priority-row { background: rgba(99, 102, 241, 0.15); border-left: 4px solid #6366f1; }
        .tab-active { background: #4f46e5 !important; color: white !important; font-weight: 900; box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.4); }
        button:active { transform: scale(0.94); transition: 0.1s; }
        .time-badge { font-size: 10px; color: #94a3b8; font-family: monospace; background: rgba(15, 23, 42, 0.6); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.05); }
        
        /* ê°œë°œì ê¹€ì§€í˜¸bwd ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .dev-neon { 
            background: linear-gradient(45deg, #6366f1, #a855f7);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.6);
            animation: dev-pulse 2s infinite;
        }
        @keyframes dev-pulse { 
            0% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(168, 85, 247, 0); }
            100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }

        .clock-item { display: flex; flex-direction: column; align-items: center; min-width: 50px; line-height: 1.1; }
        .clock-time { font-size: 10px; font-family: monospace; font-weight: bold; color: #60a5fa; }
        .clock-label { font-size: 8px; color: #64748b; font-weight: 800; }
        .name-link:hover { color: #60a5fa; text-decoration: underline; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 p-3">
        <div class="max-w-2xl mx-auto flex flex-col md:flex-row justify-between items-center gap-3">
            <div class="flex items-center gap-4 w-full md:w-auto justify-between md:justify-start">
                <span class="font-black brand-gradient italic tracking-tighter text-xl">RIVER LOG</span>
                
                <a href="https://x.com/thejediworld77" target="_blank" class="dev-neon px-4 py-2 rounded-xl flex flex-col items-center leading-tight transition-transform hover:scale-105">
                    <span class="text-[8px] font-bold text-indigo-100 uppercase tracking-widest">Developer</span>
                    <span class="text-[11px] font-black text-white">@ê¹€ì§€í˜¸bwd</span>
                </a>
            </div>
            
            <div class="flex items-center gap-3 w-full md:w-auto justify-center md:justify-end">
                <select id="langSelect" onchange="changeLanguage(this.value)" class="bg-slate-800 border border-slate-700 text-[10px] text-white rounded-lg px-2 py-1.5 outline-none">
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
                </select>

                <div class="flex gap-2 overflow-x-auto no-scrollbar">
                    <div class="clock-item"><span class="clock-label">KR</span><span id="clock-KR" class="clock-time">00:00:00</span></div>
                    <div class="clock-item"><span class="clock-label">US</span><span id="clock-US" class="clock-time">00:00:00</span></div>
                    <div class="clock-item"><span class="clock-label">CN</span><span id="clock-CN" class="clock-time">00:00:00</span></div>
                    <div class="clock-item"><span class="clock-label">JP</span><span id="clock-JP" class="clock-time">00:00:00</span></div>
                    <div class="clock-item"><span class="clock-label">VN</span><span id="clock-VN" class="clock-time">00:00:00</span></div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto p-4">
        <div class="flex justify-between gap-1 mb-6 bg-slate-800/50 p-1 rounded-xl shadow-inner no-scrollbar overflow-x-auto">
            <button onclick="switchCountry('KR')" id="tab-KR" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 transition-all font-black">KR</button>
            <button onclick="switchCountry('US')" id="tab-US" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 transition-all font-black">US</button>
            <button onclick="switchCountry('CN')" id="tab-CN" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 transition-all font-black">CN</button>
            <button onclick="switchCountry('JP')" id="tab-JP" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 transition-all font-black">JP</button>
            <button onclick="switchCountry('VN')" id="tab-VN" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 transition-all font-black">VN</button>
        </div>

        <header class="mb-6 text-center">
            <h1 class="text-2xl font-black mb-1 text-white uppercase tracking-tight"><span id="active-country-name">KOREA</span> LIST</h1>
            <p id="txt-subtitle" class="text-slate-500 text-[10px] uppercase tracking-widest font-bold">Global Member Interaction Log</p>
        </header>

        <div class="box mb-8 shadow-xl border border-indigo-500/10">
            <div class="grid grid-cols-1 gap-3 mb-4">
                <input id="userName" type="text" placeholder="ë‹‰ë„¤ì„ (Nickname)">
                <input id="userXId" type="text" placeholder="X ID (@username)">
                <input id="passCode" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="border-indigo-500/20">
            </div>
            <button onclick="saveUser()" id="btnSubmit" class="w-full bg-indigo-600 py-4 rounded-xl font-black text-white shadow-lg active:bg-indigo-700 transition-all uppercase">
                ë“±ë¡í•˜ê¸° (SUBMIT)
            </button>
        </div>

        <div class="flex justify-between items-center mb-4 px-1">
            <h2 id="txt-list-title" class="font-bold text-slate-300 text-sm uppercase tracking-wider">Members</h2>
            <span id="memberCount" class="text-[10px] text-indigo-400 font-bold bg-indigo-900/30 px-2 py-1 rounded">Total: 0</span>
        </div>

        <div class="box p-0 overflow-hidden border-slate-800 shadow-2xl">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <tbody id="userTableBody" class="text-sm divide-y divide-slate-800"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xheuxdsbwcueutukeblm.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_TW6tF_10D5-zv5FdXZE87g_8sNPZmuF'; 
        const PRIVATE_CODE = '2126';

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let currentCountry = 'KR';
        let currentLang = 'ko';

        const timeZones = { KR: 'Asia/Seoul', US: 'America/New_York', CN: 'Asia/Shanghai', JP: 'Asia/Tokyo', VN: 'Asia/Ho_Chi_Minh' };
        
        // ì™„ì „ ë‹¤êµ­ì–´ ì‚¬ì „
        const translations = {
            ko: { subtitle: "ê¸€ë¡œë²Œ ë©¤ë²„ ìƒí˜¸ì‘ìš© ê¸°ë¡", btn: "ë“±ë¡í•˜ê¸°", namePlace: "ë‹‰ë„¤ì„ (Nickname)", xPlace: "X ID (@username)", passPlace: "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”", members: "ë©¤ë²„ ë¦¬ìŠ¤íŠ¸", edit: "ì´ë¦„ ìˆ˜ì •", del: "ëª…ë‹¨ ì‚­ì œ", up: "ìˆœìœ„ ì˜¬ë¦¬ê¸°", down: "ìˆœìœ„ ë‚´ë¦¬ê¸°" },
            en: { subtitle: "Global Member Interaction Log", btn: "Submit", namePlace: "Nickname", xPlace: "X ID (@username)", passPlace: "Enter Password", members: "Members List", edit: "Edit Name", del: "Delete Entry", up: "Move Up", down: "Move Down" },
            zh: { subtitle: "å…¨çƒæˆå‘˜äº’åŠ¨è®°å½•", btn: "æäº¤åå•", namePlace: "æ˜µç§°", xPlace: "X ID (@ç”¨æˆ·å)", passPlace: "è¾“å…¥å¯†ç ", members: "æˆå‘˜åå•", edit: "ä¿®æ”¹å§“å", del: "åˆ é™¤åå•", up: "æé«˜æ’å", down: "é™ä½æ’å" },
            ja: { subtitle: "ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¡ãƒ³ãƒãƒ¼ç›¸äº’ä½œç”¨è¨˜éŒ²", btn: "ç™»éŒ²ã™ã‚‹", namePlace: "ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ", xPlace: "X ID (@ãƒ¦ãƒ¼ã‚¶ãƒ¼å)", passPlace: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›", members: "ãƒ¡ãƒ³ãƒãƒ¼åç°¿", edit: "åå‰ä¿®æ­£", del: "å‰Šé™¤", up: "é †ä½ã‚’ä¸Šã’ã‚‹", down: "é †ä½ã‚’ä¸‹ã’ã‚‹" },
            vi: { subtitle: "Ghi chÃ©p tÆ°Æ¡ng tÃ¡c thÃ nh viÃªn toÃ n cáº§u", btn: "Gá»­i danh sÃ¡ch", namePlace: "Biá»‡t danh", xPlace: "X ID (@tÃªn ngÆ°á»i dÃ¹ng)", passPlace: "Nháº­p máº­t kháº©u", members: "Danh sÃ¡ch thÃ nh viÃªn", edit: "Sá»­a tÃªn", del: "XÃ³a danh sÃ¡ch", up: "TÄƒng thá»© háº¡ng", down: "Giáº£m thá»© háº¡ng" }
        };

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('txt-subtitle').innerText = t.subtitle;
            document.getElementById('btnSubmit').innerText = t.btn;
            document.getElementById('userName').placeholder = t.namePlace;
            document.getElementById('userXId').placeholder = t.xPlace;
            document.getElementById('passCode').placeholder = t.passPlace;
            document.getElementById('txt-list-title').innerText = t.members;
            fetchUsers();
        }

        function updateLiveClocks() {
            const now = new Date();
            Object.keys(timeZones).forEach(code => {
                const timeString = now.toLocaleTimeString('en-US', { timeZone: timeZones[code], hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
                document.getElementById(`clock-${code}`).innerText = timeString;
            });
        }
        setInterval(updateLiveClocks, 1000);
        updateLiveClocks();

        function switchCountry(countryCode) {
            currentCountry = countryCode;
            const names = { KR:'KOREA', US:'USA', CN:'CHINA', JP:'JAPAN', VN:'VIETNAM' };
            document.querySelectorAll('[id^="tab-"]').forEach(btn => btn.classList.remove('tab-active'));
            document.getElementById(`tab-${countryCode}`).classList.add('tab-active');
            document.getElementById('active-country-name').innerText = names[countryCode];
            fetchUsers();
        }

        async function fetchUsers() {
            const { data, error } = await supabaseClient.from('river_members').select('*').eq('country', currentCountry).order('priority', { ascending: false }).order('id', { ascending: false });
            if (!error) renderTable(data);
        }

        function formatLocalTime(utcTime) {
            if (!utcTime) return "";
            const options = { timeZone: timeZones[currentCountry], month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false };
            return new Intl.DateTimeFormat('ko-KR', options).format(new Date(utcTime));
        }

        function renderTable(users) {
            const tableBody = document.getElementById('userTableBody');
            tableBody.innerHTML = '';
            const t = translations[currentLang];

            users.forEach((user, index) => {
                const isHigh = user.priority > 0;
                const localTime = formatLocalTime(user.created_at);
                const row = document.createElement('tr');
                row.className = isHigh ? "priority-row transition-colors" : "hover:bg-slate-800/30 transition-colors";
                row.innerHTML = `
                    <td class="p-4 w-full">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[9px] font-bold ${isHigh ? 'text-indigo-400' : 'text-slate-500'}">${isHigh ? 'â­ TOP' : '#' + (index+1)}</span>
                                    <span class="time-badge">${localTime}</span>
                                </div>
                                <a href="https://x.com/${user.x_id}" target="_blank" class="name-link font-bold text-slate-100 text-base block mb-0.5 tracking-tight cursor-pointer">
                                    ${user.name}
                                </a>
                                <div class="text-[10px] text-slate-500 font-mono tracking-tighter">@${user.x_id}</div>
                            </div>
                            <div class="flex items-center gap-1">
                                <button onclick="adjustPriority(${user.id}, ${user.priority + 1})" title="${t.up}" class="bg-indigo-900/40 text-indigo-300 p-2 rounded-lg text-xs">ğŸ”¼</button>
                                <button onclick="adjustPriority(${user.id}, ${user.priority - 1})" title="${t.down}" class="bg-slate-800 text-slate-400 p-2 rounded-lg text-xs">ğŸ”½</button>
                                <button onclick="editName(${user.id}, '${user.name}')" title="${t.edit}" class="bg-slate-800 text-amber-400/80 p-2 rounded-lg text-xs ml-1">ğŸ“</button>
                                <button onclick="deleteUser(${user.id})" title="${t.del}" class="bg-red-900/10 text-red-500/80 p-2 rounded-lg text-xs ml-1">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            document.getElementById('memberCount').innerText = `Total: ${users.length}`;
        }

        async function editName(id, oldName) {
            const newName = prompt(translations[currentLang].edit + ":", oldName);
            if (newName && newName !== oldName) {
                const pass = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                if (pass === PRIVATE_CODE) {
                    await supabaseClient.from('river_members').update({ name: newName }).eq('id', id);
                    fetchUsers();
                }
            }
        }

        async function adjustPriority(id, newP) {
            const finalP = newP < 0 ? 0 : newP;
            await supabaseClient.from('river_members').update({ priority: finalP }).eq('id', id);
            fetchUsers();
        }

        async function saveUser() {
            const name = document.getElementById('userName').value;
            const xInput = document.getElementById('userXId').value;
            const pass = document.getElementById('passCode').value;
            if (pass !== PRIVATE_CODE) { alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"); return; }
            let xId = xInput.trim().replace('@', '').split('x.com/').pop().split('?')[0];
            if (name && xId) {
                const { error } = await supabaseClient.from('river_members').insert([{ name, x_id: xId, country: currentCountry, priority: 0 }]);
                if (!error) { 
                    document.getElementById('userName').value = ''; document.getElementById('userXId').value = ''; document.getElementById('passCode').value = '';
                    fetchUsers(); 
                }
            }
        }

        async function deleteUser(id) {
            const pass = prompt(translations[currentLang].del + " - ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
            if (pass === PRIVATE_CODE) {
                await supabaseClient.from('river_members').delete().eq('id', id);
                fetchUsers();
            }
        }
        switchCountry('KR');
    </script>
</body>
</html>
