<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>River Community Activation List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 15px; }
        input, select { background: #0f172a; border: 1px solid #475569; border-radius: 8px; padding: 12px; color: white; width: 100%; outline: none; font-size: 16px; }
        .brand-gradient { background: linear-gradient(135deg, #60a5fa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .priority-row { background: rgba(99, 102, 241, 0.15); border-left: 4px solid #6366f1; }
        button:active { transform: scale(0.96); }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 p-4">
        <div class="max-w-2xl mx-auto flex justify-between items-center">
            <span class="font-black brand-gradient italic tracking-tighter">RIVER LOG</span>
            <select id="langSelect" onchange="changeLanguage(this.value)" class="w-auto text-xs bg-slate-800 border-slate-700 py-1 px-2 rounded-lg text-white">
                <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
            </select>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto p-4">
        <header class="mb-6 text-center">
            <h1 id="txt-title" class="text-2xl font-black mb-2 text-white">ë¦¬ë²„ ì»¤ë®¤ë‹ˆí‹° í™œì„±í™” ëª…ë‹¨</h1>
            <p id="txt-subtitle" class="text-slate-400 text-xs text-center">ì¤‘ìš” ë©¤ë²„ë¥¼ ìƒë‹¨ì— ê³ ì •í•˜ì—¬ ê´€ë¦¬í•˜ì„¸ìš”.</p>
        </header>

        <div class="box mb-8 shadow-xl">
            <div class="grid grid-cols-1 gap-3 mb-4">
                <input id="userName" type="text" placeholder="ë‹‰ë„¤ì„ (Name)">
                <input id="userXId" type="text" placeholder="X ID ë˜ëŠ” í”„ë¡œí•„ ì£¼ì†Œ">
                <select id="userCountry">
                    <option value="KR">Korea</option><option value="US">USA</option>
                    <option value="CN">China</option><option value="JP">Japan</option><option value="VN">Vietnam</option>
                </select>
                <input id="passCode" type="password" placeholder="ì»¤ë®¤ë‹ˆí‹° ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="border-indigo-500">
            </div>
            <button onclick="saveUser()" id="btnSubmit" class="w-full bg-indigo-600 py-4 rounded-xl font-black text-white shadow-lg transition-all">ë“±ë¡í•˜ê¸° (Submit)</button>
        </div>

        <div class="flex justify-between items-center mb-4 px-1">
            <h2 id="txt-list-title" class="font-bold text-slate-300">ìƒí˜¸ì‘ìš© ëª…ë‹¨</h2>
            <span id="memberCount" class="text-[10px] text-indigo-400 font-bold bg-indigo-900/30 px-2 py-1 rounded">Total: 0</span>
        </div>

        <div class="box p-0 overflow-hidden border-slate-800">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <tbody id="userTableBody" class="text-sm divide-y divide-slate-800"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xheuxdsbwcueutukeblm.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_TW6tF_10D5-zv5FdXZE87g_8sNPZmuF'; 
        const PRIVATE_CODE = '2126'; 

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const translations = {
            ko: { title: "ë¦¬ë²„ ì»¤ë®¤ë‹ˆí‹° í™œì„±í™” ëª…ë‹¨", subtitle: "ì¤‘ìš” ë©¤ë²„ë¥¼ ìƒë‹¨ì— ê³ ì •í•˜ì„¸ìš”.", btn: "ë“±ë¡í•˜ê¸° (Submit)", list: "ìƒí˜¸ì‘ìš© ëª…ë‹¨", passHint: "ì»¤ë®¤ë‹ˆí‹° ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”", alertPass: "ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜", alertSuccess: "ë“±ë¡ ì™„ë£Œ!" },
            en: { title: "River Activation List", subtitle: "Pin members to the top.", btn: "Submit", list: "Member List", passHint: "Enter Community Password", alertPass: "Wrong password", alertSuccess: "Success!" },
            zh: { title: "River æ¿€æ´»åå•", subtitle: "å°†æˆå‘˜å›ºå®šåœ¨é¡¶éƒ¨ã€‚", btn: "æäº¤", list: "äº’åŠ¨åˆ—è¡¨", passHint: "è¾“å…¥ç¤¾åŒºå¯†ç ", alertPass: "å¯†ç é”™è¯¯", alertSuccess: "æˆåŠŸï¼" },
            ja: { title: "River æ´»æ€§åŒ–åç°¿", subtitle: "ãƒ¡ãƒ³ãƒãƒ¼ã‚’ä¸Šéƒ¨ã«å›ºå®šã—ã¾ã™ã€‚", btn: "ç™»éŒ²ã™ã‚‹", list: "ç›¸äº’ä½œç”¨åç°¿", passHint: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›", alertPass: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸ä¸€è‡´", alertSuccess: "ç™»éŒ²å®Œäº†ï¼" },
            vi: { title: "Danh sÃ¡ch River", subtitle: "Ghim thÃ nh viÃªn lÃªn Ä‘áº§u.", btn: "Gá»­i", list: "Danh sÃ¡ch", passHint: "Nháº­p máº­t kháº©u cá»™ng Ä‘á»“ng", alertPass: "Sai máº­t kháº©u", alertSuccess: "ThÃ nh cÃ´ng!" }
        };

        let currentLang = 'ko';

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-subtitle').innerText = t.subtitle;
            document.getElementById('btnSubmit').innerText = t.btn;
            document.getElementById('txt-list-title').innerText = t.list;
            document.getElementById('passCode').placeholder = t.passHint;
        }

        async function fetchUsers() {
            const { data, error } = await supabaseClient
                .from('river_members')
                .select('*')
                .order('priority', { ascending: false })
                .order('id', { ascending: false });
            if (!error) renderTable(data);
        }

        function renderTable(users) {
            const tableBody = document.getElementById('userTableBody');
            const flags = { KR:'ğŸ‡°ğŸ‡·', US:'ğŸ‡ºğŸ‡¸', CN:'ğŸ‡¨ğŸ‡³', JP:'ğŸ‡¯ğŸ‡µ', VN:'ğŸ‡»ğŸ‡³' };
            tableBody.innerHTML = '';
            users.forEach((user, index) => {
                const isHigh = user.priority > 0;
                const row = document.createElement('tr');
                row.className = isHigh ? "priority-row" : "";
                row.innerHTML = `
                    <td class="p-4 w-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-[9px] font-bold ${isHigh ? 'text-indigo-400' : 'text-slate-500'}">${isHigh ? 'â­ TOP' : '#' + (index+1)}</span>
                                <div class="font-bold text-slate-200">${user.name} ${flags[user.country] || ''}</div>
                                <div class="text-[10px] text-slate-500">@${user.x_id}</div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="adjustPriority(${user.id}, ${user.priority + 1})" class="bg-indigo-900/40 text-indigo-300 p-2 rounded-lg text-xs">ğŸ”¼</button>
                                <button onclick="deleteUser(${user.id})" class="bg-slate-800 text-red-400 p-2 rounded-lg text-xs">ğŸ—‘ï¸</button>
                                <a href="https://x.com/${user.x_id}" target="_blank" class="bg-white text-black p-2 rounded-lg text-[10px] font-bold">VIEW</a>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            document.getElementById('memberCount').innerText = `Total: ${users.length}`;
        }

        async function adjustPriority(id, newP) {
            const pass = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (Password: 2126)");
            if (pass === PRIVATE_CODE) {
                await supabaseClient.from('river_members').update({ priority: newP }).eq('id', id);
                fetchUsers();
            }
        }

        async function saveUser() {
            const t = translations[currentLang];
            const name = document.getElementById('userName').value;
            const xInput = document.getElementById('userXId').value;
            const country = document.getElementById('userCountry').value;
            const pass = document.getElementById('passCode').value;

            if (pass !== PRIVATE_CODE) { alert(t.alertPass); return; }
            let xId = xInput.trim().replace('@', '').split('x.com/').pop().split('?')[0];

            if (name && xId) {
                const { error } = await supabaseClient.from('river_members').insert([{ name, x_id: xId, country, priority: 0 }]);
                if (!error) { location.reload(); }
            }
        }

        async function deleteUser(id) {
            const pass = prompt("ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            if (pass === PRIVATE_CODE) {
                await supabaseClient.from('river_members').delete().eq('id', id);
                fetchUsers();
            }
        }
        fetchUsers();
    </script>
</body>
</html>
